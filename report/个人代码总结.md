# 个人代码总结

## 王章瀚

### 与neo4j图数据库进行交互

这一块的主要是和neo4j图数据库进行交互的部分, 代码都在`neobase.py`里. 主要完成的工作是对`py2neo`的`node`类进行一层封装, 以提供更便捷的接口.

主要内容有:
1. 提供`FileNode`类, 以供对创建或读取到的文件结点进行操作. 这里面包括:
    1. **更新文件的关键词**(方法`update_keywords()`等)
    2. **更新文件属性**(方法`update_properties()`等)
    3. **上传文件**(方法`push_into()`, 旧版本的`merge_into()`未删除)
    4. 把用`py2neo`结果的`record`类数据转换成`FileNode`数据(静态方法`from_record`)
2. **获取文件**的函数, 可以指定关键词与属性(函数`get_files()`)
3. **通过文件名直接获取文件**的函数(函数`get_files_by_name()`)
4. **删除文件**(函数`delete_file()`)
5. **重命名文件**(函数`rename_file()`)
6. 将一个文件结点列表转换成能够传递给`d3.js`的结点和边的格式的函数(函数`file_nodes_to_d3()`)
7. 以及其他一些小函数...

### fuse

这一块是用fuse实现了文件系统应有的功能. 内部完成的部分包括但不限于`access`, `getattr`, `readdir`, `unlink`, `rename`, `open`, `read`, `write`, `flush`, `fsync`等常用且几乎必须的文件系统操作函数. 并且与`neo4j`操作紧密结合, 以期达到用户直接命令行操作亦可修改到数据库的便捷, 并真正让我们的项目成为一个文件系统, 而非单纯的索引.

这一部分的代码都实现在文件`fusebase.py`里.

### 前端设计

鉴于各种便捷, 前端设计采用浏览器端的设计. 使用 python 最常用的服务器框架`django`, 及其**MVC**的设计模式完成.

#### 页面设计

主要有两个页面:
1. home.html
2. gdbfs.html

其中, `home.html`主要功能就是提供给用户一个**用以挂载的UI界面**, 要求用户在此指定挂载点. 而`gdbfs.html`则是**操作界面**, 提供了包括但不限于如下接口:
1. 卸载文件系统
2. 添加文件
3. 查找文件
4. 打开文件
5. 删除文件

此外, 我还设计了一个**文件列表**用以直接列出文件和**文件图表示框**用以直观地显示文件. 用户可以直接点击文件结点进行访问.

#### 文件图表示

在搜查了大量资料后我们发现, 用`力导向图`可以很好地表示我们的文件. 于是经过一番查找, 发现javascript有一个很棒的画图库`d3.js`, 利用这个库可以相对方便(依然不容易:sob:)地绘制力导向图. 于是利用这个.

这一部分主要在文件`drawGraph.js`里.

#### 与后端交互

为了保证用户的良好体验, 这里利用了`ajax`(Asynchronous Javascript And XML), 以实现不刷新网页就更新页面内容等(异步).

请求数据上传到后台后, 后台会相应地调用一些函数(诸如打开, 删除, 添加文件等)完成请求, 这一部分主要在文件`views.py`实现.
